<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>College Basketball Rankings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PWG43QNM3P');
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f6f8; color: #111; }
    .page { max-width: 1100px; margin: 0 auto; padding: 20px; }
    .top-nav { margin-bottom: 20px; }
    .top-nav a { text-decoration: none; color: #111; font-weight: bold; font-size: 0.9rem; }
    .top-nav a:hover { text-decoration: underline; }
    h1 { text-align: center; margin-bottom: 10px; }
    .subtitle { text-align: center; margin-bottom: 20px; color: #555; }
    .toggle-buttons { text-align: center; margin-bottom: 20px; }
    .toggle-buttons button { padding: 8px 16px; margin: 0 5px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; background: #ddd; transition: background 0.2s; }
    .toggle-buttons button.active { background: #111; color: #fff; }
    .toggle-buttons button:hover { background: #aaa; color: #fff; }
    .conference-dropdown { text-align: center; margin-bottom: 20px; display: none; }
    .conference-dropdown select { padding: 6px 10px; border-radius: 6px; font-size: 1rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; border-radius: 6px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    th, td { padding: 8px 10px; border: 1px solid #ccc; text-align: left; }
    th { background-color: #f2f2f2; cursor: pointer; user-select: none; }
    th.sort-asc::after { content: " ▲"; }
    th.sort-desc::after { content: " ▼"; }
  </style>
</head>

<body>
<div class="page">

  <div class="top-nav">
    <a href="index.html">← Back to College Basketball</a>
  </div>

  <h1 id="title">College Basketball Rankings</h1>
  <div class="subtitle">Elo-based rankings by season (2003–2026)</div>

  <div class="toggle-buttons" id="toggle-buttons" style="display:none;">
    <button id="show-elo" class="active">Elo Rankings</button>
    <button id="show-projected" style="display:none;">Projected Seeding</button>
    <button id="show-conference" style="display:none;">Conference Elo</button>
  </div>

  <!-- Conference dropdown for 2026 only -->
  <div class="conference-dropdown" id="conference-dropdown">
    <label for="conference-select">Select Conference:</label>
    <select id="conference-select"></select>
  </div>

  <div id="elo-container">
    <table id="elo-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="projected-container" style="display:none;">
    <table id="projected-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="conference-container" style="display:none;">
    <table id="conference-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>
const params = new URLSearchParams(window.location.search);
const year = params.get("year") || "2026";
document.getElementById("title").textContent = `College Basketball ${year} Rankings`;

const eloCsv = `data/CBB_Elo_${year}.csv`;
const projectedCsv = `data/projected_bracket${year}.csv`;
const conferenceCsv = `data/CBB_Conference_Elo_${year}.csv`;

const eloContainer = document.getElementById("elo-container");
const projectedContainer = document.getElementById("projected-container");
const conferenceContainer = document.getElementById("conference-container");
const toggleButtons = document.getElementById("toggle-buttons");
const showEloBtn = document.getElementById("show-elo");
const showProjectedBtn = document.getElementById("show-projected");
const showConferenceBtn = document.getElementById("show-conference");
const conferenceDropdownDiv = document.getElementById("conference-dropdown");
const conferenceSelect = document.getElementById("conference-select");

let eloData = [], projectedData = [], conferenceData = [];
let sortState = {};

// --- Fetch Elo ---
fetch(eloCsv)
  .then(res => { if(!res.ok) throw new Error("Elo CSV not found"); return res.text(); })
  .then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));
    const headers = rows[0];
    eloData = rows.slice(1);
    renderTable(headers, eloData, document.querySelector("#elo-table thead tr"), document.querySelector("#elo-table tbody"));
  })
  .catch(() => {
    document.querySelector("#elo-table tbody").innerHTML =
      `<tr><td colspan="20">Elo data not found for ${year}.</td></tr>`;
  });

// --- Fetch Projected (only show button if CSV exists) ---
fetch(projectedCsv)
  .then(res => {
    if(!res.ok) throw new Error("No projected CSV");
    return res.text();
  })
  .then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));
    const headers = rows[0];
    projectedData = rows.slice(1);
    renderTable(headers, projectedData, document.querySelector("#projected-table thead tr"), document.querySelector("#projected-table tbody"));
    showProjectedBtn.style.display = "inline-block";
    toggleButtons.style.display = "block";
  })
  .catch(() => { console.warn(`No projected bracket for ${year}`); });

// --- Fetch Conference Elo ---
fetch(conferenceCsv)
  .then(res => { if(!res.ok) throw new Error("Conference CSV not found"); return res.text(); })
  .then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));
    const headers = rows[0];
    conferenceData = rows.slice(1);
    renderTable(headers, conferenceData, document.querySelector("#conference-table thead tr"), document.querySelector("#conference-table tbody"));
    showConferenceBtn.style.display = "inline-block";
    toggleButtons.style.display = "block";

    // Only show dropdown for 2026
    if(year === "2026") {
      conferenceDropdownDiv.style.display = "block";

      // List of all 31 conferences with CSVs for 2026
      const conferences = [
        "American_Conference","Atlantic_Coast_Conference","Big_Ten_Conference","Big_12_Conference",
        "Conference_USA","Mid_American_Conference","Mountain_West_Conference","Pac_12_Conference",
        "Southeastern_Conference","Sun_Belt_Conference","Western_Conference","Missouri_Valley_Conference",
        "Big_East_Conference","Horizon_League","Metro_Atlantic_Conference","Ohio_Valley_Conference",
        "Patriot_League","Southern_Conference","Southland_Conference","SWAC_Conference",
        "Big_Sky_Conference","Big_South_Conference","Colonial_Conference","Ivy_League",
        "NEC_Conference","MAAC_Conference","OVC_Conference","WCC_Conference",
        "Summit_League","West_Atlantic_Conference","Southwestern_Conference"
      ];

      // Populate dropdown
      conferences.forEach(conf => {
        const option = document.createElement("option");
        option.value = `data/${conf}_Elo_${year}.csv`;
        option.textContent = conf.replace(/_/g," ");
        conferenceSelect.appendChild(option);
      });

      // Load selected conference
      conferenceSelect.addEventListener("change", () => {
        const confCsv = conferenceSelect.value;
        fetch(confCsv)
          .then(res => { if(!res.ok) throw new Error("Conference CSV not found"); return res.text(); })
          .then(csv => {
            const rows = csv.trim().split("\n").map(r => r.split(","));
            const headers = rows[0];
            const data = rows.slice(1);
            renderTable(headers, data, document.querySelector("#conference-table thead tr"), document.querySelector("#conference-table tbody"));
          })
          .catch(() => {
            document.querySelector("#conference-table tbody").innerHTML =
              `<tr><td colspan="20">Conference data not found.</td></tr>`;
          });
      });

      // Load first conference by default
      conferenceSelect.dispatchEvent(new Event('change'));
    }

  })
  .catch(() => { console.warn(`Conference CSV not found for ${year}`); });

function renderTable(headers, data, theadRow, tbody) {
  theadRow.innerHTML = "";
  tbody.innerHTML = "";

  headers.forEach((header, index) => {
    const th = document.createElement("th");
    th.textContent = header;
    th.addEventListener("click", () => sortByColumn(index, data, tbody, th));
    theadRow.appendChild(th);
  });

  data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function sortByColumn(colIndex, data, tbody, th) {
  const headers = th.parentElement.querySelectorAll("th");
  headers.forEach(h => h.classList.remove("sort-asc","sort-desc"));

  const ascending = sortState[colIndex] !== "asc";
  sortState = { [colIndex]: ascending ? "asc" : "desc" };
  th.classList.add(ascending ? "sort-asc" : "sort-desc");

  data.sort((a,b) => {
    const A = parseFloat(a[colIndex]);
    const B = parseFloat(b[colIndex]);
    if (!isNaN(A) && !isNaN(B)) return ascending ? A - B : B - A;
    return ascending ? a[colIndex].localeCompare(b[colIndex]) : b[colIndex].localeCompare(a[colIndex]);
  });

  tbody.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

// --- Toggle buttons ---
showEloBtn.onclick = () => {
  eloContainer.style.display = "block";
  projectedContainer.style.display = "none";
  conferenceContainer.style.display = "none";
  showEloBtn.classList.add("active");
  showProjectedBtn.classList.remove("active");
  showConferenceBtn.classList.remove("active");
};

showProjectedBtn.onclick = () => {
  eloContainer.style.display = "none";
  projectedContainer.style.display = "block";
  conferenceContainer.style.display = "none";
  showEloBtn.classList.remove("active");
  showProjectedBtn.classList.add("active");
  showConferenceBtn.classList.remove("active");
};

showConferenceBtn.onclick = () => {
  eloContainer.style.display = "none";
  projectedContainer.style.display = "none";
  conferenceContainer.style.display = "block";
  showEloBtn.classList.remove("active");
  showProjectedBtn.classList.remove("active");
  showConferenceBtn.classList.add("active");
};
</script>
</body>
</html>
