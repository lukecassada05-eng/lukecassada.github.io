<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College Basketball Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PWG43QNM3P');
</script>

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; color:#111; }
.page { max-width:1100px; margin:0 auto; padding:20px; }

h1 { text-align:center; }
.subtitle { text-align:center; color:#555; margin-bottom:15px; }

.toggle-buttons { text-align:center; margin-bottom:15px; }
.toggle-buttons button {
  padding:8px 16px; margin:0 4px;
  border:none; border-radius:6px;
  font-weight:bold; cursor:pointer;
  background:#ddd;
}
.toggle-buttons button.active { background:#111; color:#fff; }

.search-box {
  margin:10px 0;
  text-align:right;
}
.search-box input {
  padding:6px 10px;
  width:220px;
  border-radius:5px;
  border:1px solid #ccc;
}

.table-wrapper {
  max-height:75vh;
  overflow:auto;
}

table {
  border-collapse:collapse;
  width:100%;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
th, td {
  padding:8px 10px;
  border:1px solid #ccc;
}
th {
  background:#f2f2f2;
  cursor:pointer;
  position:sticky;
  top:0;
  z-index:2;
}
th.sort-asc::after { content:" ▲"; }
th.sort-desc::after { content:" ▼"; }

tbody tr:hover { background:#f0f4f8; }

td.num { text-align:right; font-variant-numeric: tabular-nums; }
td.center { text-align:center; }

/* Conditional coloring */
.elo-top { background:#e6f4ea; }
.elo-mid { background:#e8f0fe; }
.elo-bubble { background:#fff4e5; }

.good { color:#137333; font-weight:bold; }
.bad { color:#a50e0e; font-weight:bold; }
.neutral { color:#555; }

@media (max-width:700px){
  th, td { font-size:0.8rem; }
}
</style>
</head>

<body>
<div class="page">

<h1 id="title">College Basketball Rankings</h1>
<div class="subtitle">Elo-based rankings by season (2003–2026)</div>

<div class="toggle-buttons" id="toggle-buttons"></div>

<div class="search-box">
  <input id="searchInput" placeholder="Search team…">
</div>

<div class="table-wrapper">
  <table id="main-table">
    <thead><tr></tr></thead>
    <tbody></tbody>
  </table>
</div>

</div>

<script>
const params = new URLSearchParams(window.location.search);
const year = params.get("year") || "2026";
document.getElementById("title").textContent = `College Basketball ${year} Rankings`;

const eloCsv = `data/CBB_Elo_${year}.csv`;

let tableData = [];
let headers = [];
let sortState = {};

fetch(eloCsv)
.then(r=>r.text())
.then(csv=>{
  const rows = csv.trim().split("\n").map(r=>r.split(","));
  headers = rows[0];
  tableData = rows.slice(1);
  render(headers, tableData);
  autoSort(headers);
});

document.getElementById("searchInput").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  const filtered = tableData.filter(r => r.join(" ").toLowerCase().includes(q));
  render(headers, filtered, false);
});

function render(headers,data,resetSort=true){
  const thead = document.querySelector("thead tr");
  const tbody = document.querySelector("tbody");
  thead.innerHTML=""; tbody.innerHTML="";

  headers.forEach((h,i)=>{
    const th=document.createElement("th");
    th.textContent=h;
    th.title=`Sort by ${h}`;
    th.onclick=()=>sortBy(i);
    thead.appendChild(th);
  });

  data.forEach((row,idx)=>{
    const tr=document.createElement("tr");
    row.forEach((cell,i)=>{
      const td=document.createElement("td");

      const num=parseFloat(cell);
      if(!isNaN(num)){
        td.textContent = num % 1 !== 0 ? num.toFixed(2) : num.toLocaleString();
        td.classList.add("num");
      } else {
        td.textContent=cell;
      }

      if(headers[i].toLowerCase().includes("elo")){
        if(num>=1800) tr.classList.add("elo-top");
        else if(num>=1650) tr.classList.add("elo-mid");
        else if(num>=1550) tr.classList.add("elo-bubble");
      }

      if(headers[i].toLowerCase().includes("sos")){
        if(num>=10) td.classList.add("good");
        if(num<=-10) td.classList.add("bad");
      }

      if(headers[i].toLowerCase().includes("prob")){
        if(num>=0.7) td.classList.add("good");
        else if(num<=0.3) td.classList.add("bad");
        else td.classList.add("neutral");
      }

      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function sortBy(col){
  const asc = sortState[col] !== "asc";
  sortState = { [col]: asc?"asc":"desc" };

  tableData.sort((a,b)=>{
    const A=parseFloat(a[col]), B=parseFloat(b[col]);
    if(!isNaN(A)&&!isNaN(B)) return asc?A-B:B-A;
    return asc?a[col].localeCompare(b[col]):b[col].localeCompare(a[col]);
  });

  render(headers, tableData, false);
}

function autoSort(headers){
  const eloIndex = headers.findIndex(h=>h.toLowerCase().includes("elo"));
  if(eloIndex>=0) sortBy(eloIndex);
}
</script>

</body>
</html>
