<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College Basketball Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PWG43QNM3P');
</script>

<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f6f8; color: #111; }
  .page { max-width: 1100px; margin: 0 auto; padding: 20px; }

  .top-nav { margin-bottom: 20px; }
  .top-nav a { text-decoration: none; color: #111; font-weight: bold; font-size: 0.9rem; }
  .top-nav a:hover { text-decoration: underline; }

  h1 { text-align: center; margin-bottom: 10px; }
  .subtitle { text-align: center; margin-bottom: 20px; color: #555; }

  .toggle-buttons { text-align: center; margin-bottom: 20px; }
  .toggle-buttons button {
    padding: 8px 16px; margin: 0 5px; border: none; border-radius: 6px; font-weight: bold;
    cursor: pointer; background: #ddd; transition: 0.2s;
  }
  .toggle-buttons button.active { background: #111; color: #fff; }
  .toggle-buttons button:hover { background: #aaa; color: #fff; }

  table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; border-radius: 6px; overflow: hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
  th, td { padding: 8px 10px; border: 1px solid #ccc; text-align: left; }
  th { background-color: #f2f2f2; cursor: pointer; user-select: none; }
  th.sort-asc::after { content: " ▲"; }
  th.sort-desc::after { content: " ▼"; }

  select { padding: 6px 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ccc; }

  /* Row highlights (whole row) */
  .top10-row { background: #cce5ff; }       
  .top3-row { background: #d4f0d4; }        
  .conf-leader-row { background: #fff3b3; } 
  .auto-bid-row { background: #a8e6a3; }    
  .at-large-row { background: #ffdda0; }    
  .win-row { background: #c6f5c6; }         
  .lose-row { background: #f8d7da; }        
</style>
</head>

<body>
<div class="page">

  <div class="top-nav">
    <a href="index.html">← Back to College Basketball</a>
  </div>

  <h1 id="title">College Basketball Rankings</h1>
  <div class="subtitle">Elo-based rankings by season (2003–2026)</div>

  <div class="toggle-buttons" id="toggle-buttons" style="display:none;">
    <button id="show-elo" class="active">Elo Rankings</button>
    <button id="show-projected">Projected Seeding</button>
    <button id="show-conf-elo">Conference Elo</button>
    <button id="show-conf-standings">Conference Standings (2026)</button>
    <button id="show-game-predictor">Game Predictor (2026)</button>
    <button id="show-resume">Resume (2026)</button>
  </div>

  <!-- Elo Rankings -->
  <div id="elo-container">
    <table id="elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

  <!-- Projected Bracket -->
  <div id="projected-container" style="display:none;">
    <table id="projected-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

  <!-- Conference Elo -->
  <div id="conf-elo-container" style="display:none;">
    <table id="conf-elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

  <!-- Conference Standings -->
  <div id="conf-standings-container" style="display:none;">
    <select id="conf-dropdown"></select>
    <table id="conf-standings-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

  <!-- Game Predictor -->
  <div id="game-predictor-container" style="display:none;">
    <table id="game-predictor-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

  <!-- Resume Tab -->
  <div id="resume-container" style="display:none;">
    <table id="resume-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

</div>

<script>
// --- Setup ---
const params = new URLSearchParams(window.location.search);
const year = params.get("year") || "2026";
document.getElementById("title").textContent = `College Basketball ${year} Rankings`;

const eloCsv = `data/CBB_Elo_${year}.csv`;
const projectedCsv = `data/projected_bracket${year}.csv`;
const confEloCsv = `data/CBB_Conference_Elo_${year}.csv`;

const eloContainer = document.getElementById("elo-container");
const projectedContainer = document.getElementById("projected-container");
const confEloContainer = document.getElementById("conf-elo-container");
const confStandingsContainer = document.getElementById("conf-standings-container");
const gamePredictorContainer = document.getElementById("game-predictor-container");
const resumeContainer = document.getElementById("resume-container");
const toggleButtons = document.getElementById("toggle-buttons");

const showEloBtn = document.getElementById("show-elo");
const showProjectedBtn = document.getElementById("show-projected");
const showConfEloBtn = document.getElementById("show-conf-elo");
const showConfStandingsBtn = document.getElementById("show-conf-standings");
const showGamePredictorBtn = document.getElementById("show-game-predictor");
const showResumeBtn = document.getElementById("show-resume");

let sortState = {};

// --- Conference files ---
const confFiles = {
  "ASUN": "ASUN_Conference_Elo_2026.csv",
  "America_East": "America_East_Conference_Elo_2026.csv",
  "American": "American_Conference_Elo_2026.csv",
  "Atlantic_10": "Atlantic_10_Conference_Elo_2026.csv",
  "Atlantic_Coast": "Atlantic_Coast_Conference_Elo_2026.csv",
  "Big_12": "Big_12_Conference_Elo_2026.csv",
  "Big_East": "Big_East_Conference_Elo_2026.csv",
  "Big_Sky": "Big_Sky_Conference_Elo_2026.csv",
  "Big_South": "Big_South_Conference_Elo_2026.csv",
  "Big_Ten": "Big_Ten_Conference_Elo_2026.csv",
  "Big_West": "Big_West_Conference_Elo_2026.csv",
  "Coastal_Athletic_Association": "Coastal_Athletic_Association_Elo_2026.csv",
  "Conference_USA": "Conference_USA_Elo_2026.csv",
  "Horizon_League": "Horizon_League_Elo_2026.csv",
  "Ivy_League": "Ivy_League_Conference_Elo_2026.csv",
  "Metro_Atlantic_Athletic_Conference": "Metro_Atlantic_Athletic_Conference_Elo_2026.csv",
  "Mid_American": "Mid_American_Conference_Elo_2026.csv",
  "Mid_Eastern_Athletic": "Mid_Eastern_Athletic_Conference_Elo_2026.csv",
  "Missouri_Valley": "Missouri_Valley_Conference_Elo_2026.csv",
  "Mountain_West": "Mountain_West_Conference_Elo_2026.csv",
  "Northeast": "Northeast_Conference_Elo_2026.csv",
  "Ohio_Valley": "Ohio_Valley_Conference_Elo_2026.csv",
  "Patriot": "Patriot_League_Elo_2026.csv",
  "Southeastern": "Southeastern_Conference_Elo_2026.csv",
  "Southern": "Southern_Conference_Elo_2026.csv",
  "Southland": "Southland_Conference_Elo_2026.csv",
  "Southwestern_Athletic": "Southwestern_Athletic_Conference_Elo_2026.csv",
  "Summit": "Summit_League_Elo_2026.csv",
  "Sun_Belt": "Sun_Belt_Conference_Elo_2026.csv",
  "West_Coast": "West_Coast_Conference_Elo_2026.csv",
  "Western_Athletic": "Western_Athletic_Conference_Elo_2026.csv"
};

// --- CSV fetch ---
function fetchCSV(path, callback, errorMsg){
  fetch(path).then(r=>r.ok?r.text():Promise.reject()).then(csv=>{
    const rows = csv.trim().split("\n").map(r=>r.split(","));
    callback(rows);
  }).catch(()=>console.warn(errorMsg));
}

// --- Render table ---
function renderTable(headers,data,theadRow,tbody,highlightTop=0,highlightCol=-1,highlightClass=""){
  theadRow.innerHTML = ""; tbody.innerHTML = "";
  headers.forEach((h,i)=>{
    const th = document.createElement("th");
    th.textContent = h;
    th.addEventListener("click",()=>sortTable(i,data,tbody,th,highlightTop,highlightCol,highlightClass));
    theadRow.appendChild(th);
  });
  data.forEach((row,index)=>{
    const tr = document.createElement("tr");
    if(highlightTop>0 && index<highlightTop) tr.classList.add(highlightClass);
    row.forEach((cell)=>{ const td = document.createElement("td"); td.textContent = cell; tr.appendChild(td); });
    tbody.appendChild(tr);
  });
}

function sortTable(colIndex, data, tbody, th, highlightTop, highlightCol, highlightClass){
  const headers = th.parentElement.querySelectorAll("th");
  headers.forEach(h=>h.classList.remove("sort-asc","sort-desc"));
  const ascending = sortState[colIndex] !== "asc";
  sortState = { [colIndex]: ascending?"asc":"desc" };
  th.classList.add(ascending?"sort-asc":"sort-desc");
  data.sort((a,b)=>{
    const A=parseFloat(a[colIndex]), B=parseFloat(b[colIndex]);
    if(!isNaN(A)&&!isNaN(B)) return ascending?A-B:B-A;
    return ascending?a[colIndex].toString().localeCompare(b[colIndex].toString()):b[colIndex].toString().localeCompare(a[colIndex].toString());
  });
  populateRows(data, tbody, highlightTop, highlightCol, highlightClass);
}

function populateRows(data, tbody, highlightTop, highlightCol, highlightClass){
  tbody.innerHTML = "";
  data.forEach((row,index)=>{
    const tr = document.createElement("tr");
    if(highlightTop>0 && index<highlightTop) tr.classList.add(highlightClass);
    row.forEach((cell)=>{ const td = document.createElement("td"); td.textContent = cell; tr.appendChild(td); });
    tbody.appendChild(tr);
  });
}

// --- Projected bracket ---
function renderProjectedBracket(headers,data,theadRow,tbody){
  theadRow.innerHTML=""; tbody.innerHTML="";
  const autoBidCol = headers.findIndex(h=>h.toLowerCase().includes("auto_bid"));
  headers.forEach((h,i)=>{
    const th = document.createElement("th"); th.textContent=h;
    th.addEventListener("click",()=>sortTable(i,data,tbody,th,0,autoBidCol,"auto-bid-row"));
    theadRow.appendChild(th);
  });
  data.forEach(row=>{
    const tr = document.createElement("tr");
    row.forEach((cell,i)=>{
      const td = document.createElement("td"); td.textContent=cell; tr.appendChild(td);
      if(i===autoBidCol){
        tr.classList.add(cell.toLowerCase()==="true"?"auto-bid-row":"at-large-row");
      }
    });
    tbody.appendChild(tr);
  });
}

// --- Toggle Tabs ---
function toggleTab(showContainer, activeBtn){
  [eloContainer, projectedContainer, confEloContainer, confStandingsContainer, gamePredictorContainer, resumeContainer].forEach(c=>{ if(c)c.style.display="none"; });
  [showEloBtn, showProjectedBtn, showConfEloBtn, showConfStandingsBtn, showGamePredictorBtn, showResumeBtn].forEach(b=>{ if(b)b.classList.remove("active"); });
  if(showContainer) showContainer.style.display="block";
  if(activeBtn) activeBtn.classList.add("active");
}

showEloBtn.onclick = ()=>toggleTab(eloContainer, showEloBtn);
showProjectedBtn.onclick = ()=>toggleTab(projectedContainer, showProjectedBtn);
showConfEloBtn.onclick = ()=>toggleTab(confEloContainer, showConfEloBtn);
showConfStandingsBtn.onclick = ()=>toggleTab(confStandingsContainer, showConfStandingsBtn);
showGamePredictorBtn.onclick = ()=>toggleTab(gamePredictorContainer, showGamePredictorBtn);
showResumeBtn.onclick = ()=>toggleTab(resumeContainer, showResumeBtn);

// --- Load CSVs ---
fetchCSV(eloCsv, rows=>{
  renderTable(rows[0], rows.slice(1), document.querySelector("#elo-table thead tr"), document.querySelector("#elo-table tbody"), 10, 0, "top10-row");
  toggleButtons.style.display="block";
}, `Elo CSV not found`);

fetchCSV(projectedCsv, rows=>{
  renderProjectedBracket(rows[0], rows.slice(1), document.querySelector("#projected-table thead tr"), document.querySelector("#projected-table tbody"));
  showProjectedBtn.style.display="inline-block";
}, "Projected CSV not found");

fetchCSV(confEloCsv, rows=>{
  renderTable(rows[0], rows.slice(1), document.querySelector("#conf-elo-table thead tr"), document.querySelector("#conf-elo-table tbody"), 3, 0, "top3-row");
  showConfEloBtn.style.display="inline-block";
}, "Conference Elo CSV not found");

// --- 2026-specific ---
if(year==="2026"){
  showConfStandingsBtn.style.display="inline-block";
  showGamePredictorBtn.style.display="inline-block";
  showResumeBtn.style.display="inline-block";

  const confDropdown = document.getElementById("conf-dropdown");
  Object.keys(confFiles).forEach(conf=>{
    const opt = document.createElement("option");
    opt.value = conf; opt.textContent = conf.replace(/_/g," ");
    confDropdown.appendChild(opt);
  });

  confDropdown.addEventListener("change", ()=>{
    const file = confFiles[confDropdown.value];
    if(file){
      fetchCSV(`data/${file}`, rows=>{
        renderTable(rows[0], rows.slice(1), document.querySelector("#conf-standings-table thead tr"), document.querySelector("#conf-standings-table tbody"),1,0,"conf-leader-row");
      }, `${confDropdown.value} CSV not found`);
    }
  });

  fetchCSV("data/CBB_Elo_Future_Game_Predictions.csv", rows=>{
    const tbody = document.querySelector("#game-predictor-table tbody");
    const theadRow = document.querySelector("#game-predictor-table thead tr");
    theadRow.innerHTML=""; tbody.innerHTML="";
    rows[0].forEach((h,i)=>{
      const th=document.createElement("th"); th.textContent=h;
      th.addEventListener("click",()=>sortTable(i, rows.slice(1), tbody, th,0,-1,""));
      theadRow.appendChild(th);
    });
    rows.slice(1).forEach(row=>{
      const tr=document.createElement("tr");
      row.forEach((cell,i)=>{
        const td=document.createElement("td"); td.textContent=cell; tr.appendChild(td);
      });
      // Apply win/lose row coloring
      const winnerCol = rows[0].findIndex(h=>h.toLowerCase().includes("winner"));
      if(winnerCol>=0){
        if(row[winnerCol].toLowerCase()==="true") tr.classList.add("win-row");
        else if(row[winnerCol].toLowerCase()==="false") tr.classList.add("lose-row");
      }
      tbody.appendChild(tr);
    });
  }, "Game Predictor CSV not found");

  fetchCSV("data/CBB_Projected_Records_SOS_2026.csv", rows=>{
    renderTable(rows[0], rows.slice(1), document.querySelector("#resume-table thead tr"), document.querySelector("#resume-table tbody"), 3, 0, "top3-row");
  }, "Resume CSV not found");
}
</script>

</body>
</html>



