<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College Basketball Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PWG43QNM3P');
</script>

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; color:#111; }
.page { max-width:1200px; margin:0 auto; padding:20px; }
h1 { text-align:center; margin-bottom:10px; }
.subtitle { text-align:center; margin-bottom:20px; color:#555; }
.toggle-buttons { text-align:center; margin-bottom:20px; }
.toggle-buttons button { padding:8px 16px; margin:0 5px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; background:#ddd; transition:0.2s; }
.toggle-buttons button.active { background:#111; color:#fff; }
.toggle-buttons button:hover { background:#aaa; color:#fff; }

table { border-collapse:collapse; width:100%; margin-top:10px; background:#fff; border-radius:6px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
th, td { padding:8px 10px; border:1px solid #ccc; text-align:left; }
th { background-color:#f2f2f2; cursor:pointer; user-select:none; }
th.sort-asc::after { content:" ▲"; }
th.sort-desc::after { content:" ▼"; }

select { padding:6px 10px; margin-bottom:15px; border-radius:5px; border:1px solid #ccc; }

/* Row colors */
.auto-bid { background:#c8f7c5; font-weight:bold; }
.at-large { background:#ffe4b2; font-weight:bold; }
.top10 { background:#b2f0f7; }
.bottom10 { background:#f7b2b2; }
.top3 { background:#a8e6a3; }
.bottom3 { background:#f7a3a3; }
.conf-leader { background:#ffeb99; font-weight:bold; }
.conf-mid { background:#f0f0f0; }
.conf-last { background:#f7b2b2; }
.win { background:#b2f7b2; font-weight:bold; }
.lose { background:#f7b2b2; font-weight:bold; }
</style>
</head>

<body>
<div class="page">
  <h1 id="title">College Basketball Rankings</h1>
  <div class="subtitle">Elo-based rankings by season (2003–2026)</div>

  <div class="toggle-buttons" id="toggle-buttons">
    <button id="show-elo" class="active">Elo Rankings</button>
    <button id="show-projected">Projected Bracket</button>
    <button id="show-conf-elo">Conference Elo</button>
    <button id="show-conf-standings">Conference Standings</button>
    <button id="show-game-predictor">Game Predictor</button>
    <button id="show-resume">Resume</button>
  </div>

  <div id="elo-container">
    <table id="elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="projected-container" style="display:none;">
    <table id="projected-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="conf-elo-container" style="display:none;">
    <table id="conf-elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="conf-standings-container" style="display:none;">
    <select id="conf-dropdown"></select>
    <table id="conf-standings-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="game-predictor-container" style="display:none;">
    <table id="game-predictor-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="resume-container" style="display:none;">
    <table id="resume-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const year = params.get("year") || "2026";
document.getElementById("title").textContent = `College Basketball ${year} Rankings`;

const toggleButtons = {
  "elo": document.getElementById("show-elo"),
  "projected": document.getElementById("show-projected"),
  "conf-elo": document.getElementById("show-conf-elo"),
  "conf-standings": document.getElementById("show-conf-standings"),
  "game-predictor": document.getElementById("show-game-predictor"),
  "resume": document.getElementById("show-resume")
};

function toggle(tab){
  ["elo","projected","conf-elo","conf-standings","game-predictor","resume"].forEach(c=>{
    document.getElementById(`${c}-container`).style.display = (c===tab)?"block":"none";
    toggleButtons[c].classList.toggle("active", c===tab);
  });
}

// General row coloring function
function renderTable(headers,data,thead,tbody,colorFn){
  thead.innerHTML=""; tbody.innerHTML="";
  headers.forEach(h=>{
    const th = document.createElement("th");
    th.textContent = h;
    thead.appendChild(th);
  });
  data.forEach((row,i)=>{
    const tr = document.createElement("tr");
    row.forEach(cell=>{
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    if(colorFn) colorFn(tr,row,i);
    tbody.appendChild(tr);
  });
}

// CSV fetch utility
async function fetchCSV(path){
  try {
    const res = await fetch(path);
    if(!res.ok) throw new Error("CSV not found");
    const text = await res.text();
    const rows = text.trim().split("\n").map(r=>r.split(","));
    return {headers: rows[0], data: rows.slice(1)};
  } catch(e){ console.warn(path, e); return null; }
}

// --- Elo Rankings ---
fetchCSV(`data/CBB_Elo_${year}.csv`).then(csv=>{
  if(csv) renderTable(csv.headers,csv.data,document.querySelector("#elo-table thead tr"),document.querySelector("#elo-table tbody"),(tr,row)=>{
    const elo=parseFloat(row[3]);
    if(elo>1750) tr.classList.add("top10");
    else if(elo<1300) tr.classList.add("bottom10");
  });
});

// --- Projected Bracket ---
fetchCSV(`data/projected_bracket${year}.csv`).then(csv=>{
  if(csv){
    renderTable(csv.headers,csv.data,document.querySelector("#projected-table thead tr"),document.querySelector("#projected-table tbody"),(tr,row)=>{
      if(row.includes("true")) tr.classList.add("auto-bid");
      else tr.classList.add("at-large");
    });
  }
});

// --- Conference Elo ---
fetchCSV(`data/CBB_Conference_Elo_${year}.csv`).then(csv=>{
  if(csv){
    renderTable(csv.headers,csv.data,document.querySelector("#conf-elo-table thead tr"),document.querySelector("#conf-elo-table tbody"),(tr,row)=>{
      const val=parseFloat(row[2]);
      if(val>1700) tr.classList.add("top3");
      else if(val<1650) tr.classList.add("bottom3");
    });
  }
});

// --- Conference Standings (2026 only) ---
if(year==="2026"){
  const conferences = ["ASUN","ACC","Big_Ten","Big_12"];
  const confDropdown = document.getElementById("conf-dropdown");
  conferences.forEach(c=>{
    const opt = document.createElement("option");
    opt.value=c;
    opt.textContent=c.replace(/_/g," ");
    confDropdown.appendChild(opt);
  });
  confDropdown.addEventListener("change", ()=>{
    const conf = confDropdown.value;
    fetchCSV(`data/${conf}_Conference_Elo_2026.csv`).then(csv=>{
      if(csv){
        renderTable(csv.headers,csv.data,document.querySelector("#conf-standings-table thead tr"),document.querySelector("#conf-standings-table tbody"),(tr,row,i)=>{
          if(i===0) tr.classList.add("conf-leader");
          else if(i===csv.data.length-1) tr.classList.add("conf-last");
          else tr.classList.add("conf-mid");
        });
      }
    });
  });
}

// --- Game Predictor ---
fetchCSV("data/CBB_Elo_Future_Game_Predictions.csv").then(csv=>{
  if(csv){
    renderTable(csv.headers,csv.data,document.querySelector("#game-predictor-table thead tr"),document.querySelector("#game-predictor-table tbody"),(tr,row)=>{
      if(row[3]===row[1]) tr.classList.add("win");
      else tr.classList.add("lose");
    });
  }
});

// --- Resume ---
fetchCSV(`data/CBB_Projected_Records_SOS_${year}.csv`).then(csv=>{
  if(csv){
    renderTable(csv.headers,csv.data,document.querySelector("#resume-table thead tr"),document.querySelector("#resume-table tbody"),(tr,row)=>{
      const val=parseFloat(row[1]);
      if(val>25) tr.classList.add("top3");
      else if(val<10) tr.classList.add("bottom3");
    });
  }
});

// --- Toggle buttons ---
showEloBtn.onclick=()=>toggle("elo");
showProjectedBtn.onclick=()=>toggle("projected");
showConfEloBtn.onclick=()=>toggle("conf-elo");
showConfStandingsBtn.onclick=()=>toggle("conf-standings");
showGamePredictorBtn.onclick=()=>toggle("game-predictor");
showResumeBtn.onclick=()=>toggle("resume");

</script>
</body>
</html>
