<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College Basketball Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PWG43QNM3P');
</script>

<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; color:#111; }
  .page { max-width:1100px; margin:0 auto; padding:20px; }
  .top-nav { margin-bottom:20px; }
  .top-nav a { text-decoration:none; color:#111; font-weight:bold; font-size:0.9rem; }
  .top-nav a:hover { text-decoration:underline; }
  h1 { text-align:center; margin-bottom:10px; }
  .subtitle { text-align:center; margin-bottom:20px; color:#555; }
  .toggle-buttons { text-align:center; margin-bottom:20px; }
  .toggle-buttons button {
    padding:8px 16px; margin:0 5px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; background:#ddd; transition:0.2s;
  }
  .toggle-buttons button.active { background:#111; color:#fff; }
  .toggle-buttons button:hover { background:#aaa; color:#fff; }

  table { border-collapse:collapse; width:100%; margin-top:10px; background:#fff; border-radius:6px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
  th, td { padding:8px 10px; border:1px solid #ccc; text-align:left; }
  th { background-color:#f2f2f2; cursor:pointer; user-select:none; }
  th.sort-asc::after { content:" ▲"; }
  th.sort-desc::after { content:" ▼"; }
  select { padding:6px 10px; margin-bottom:15px; border-radius:5px; border:1px solid #ccc; }

  /* Highlight classes */
  .top10 { background: #e0f7fa; }        
  .top3 { background: #e8f5e9; }         
  .conf-leader { background: #fff3e0; }  
  .win { background: #d0f0c0; }          
  .lose { background: #f8d7da; }         
  .auto-bid { background: #d4f0d4; }     
  .at-large { background: #ffe4b2; }     

  /* Enhancements styling */
  #enhancements { margin-bottom:30px; }
  #matchup-container, #team-stats-container { text-align:center; margin-bottom:20px; }
  #team-selects select { padding:6px 10px; margin:0 5px; border-radius:5px; border:1px solid #ccc; }
  #predicted-winner { font-weight:bold; margin-top:10px; font-size:1.1rem; }
  #graphs-container { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; margin-bottom:20px; }
  .graph { flex:1; min-width:300px; }
  canvas { background:#fff; border-radius:6px; padding:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
  .record-win { color:green; font-weight:bold; }
  .record-loss { color:red; font-weight:bold; }

</style>
</head>

<body>
<div class="page">

  <div class="top-nav">
    <a href="index.html">← Back to College Basketball</a>
  </div>

  <h1 id="title">College Basketball Rankings</h1>
  <div class="subtitle">Elo-based rankings by season (2003–2026)</div>

  <!-- ENHANCEMENTS SECTION -->
  <div id="enhancements">
    <div id="matchup-container">
      <div id="team-selects">
        <select id="team1"><option>Loading...</option></select>
        vs
        <select id="team2"><option>Loading...</option></select>
        <button id="predict-btn">Predict Winner</button>
      </div>
      <div id="predicted-winner"></div>
    </div>

    <div id="graphs-container">
      <div class="graph"><canvas id="elo-bar-chart"></canvas></div>
      <div class="graph"><canvas id="predictor-scatter"></canvas></div>
    </div>

    <div id="team-stats-container">
      <select id="team-stats-select"><option>Loading...</option></select>
      <div id="team-stats-output"></div>
    </div>
  </div>

  <!-- ORIGINAL TOGGLE BUTTONS AND TABLES -->
  <div class="toggle-buttons" id="toggle-buttons" style="display:none;">
    <button id="show-elo" class="active">Elo Rankings</button>
    <button id="show-projected">Projected Seeding</button>
    <button id="show-conf-elo">Conference Elo</button>
    <button id="show-conf-standings">Conference Standings (2026)</button>
    <button id="show-game-predictor">Game Predictor (2026)</button>
    <button id="show-resume">Resume (2026)</button>
  </div>

  <div id="elo-container">
    <table id="elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="projected-container" style="display:none;">
    <table id="projected-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="conf-elo-container" style="display:none;">
    <table id="conf-elo-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="conf-standings-container" style="display:none;">
    <select id="conf-dropdown"></select>
    <table id="conf-standings-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="game-predictor-container" style="display:none;">
    <table id="game-predictor-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>
  <div id="resume-container" style="display:none;">
    <table id="resume-table"><thead><tr></tr></thead><tbody></tbody></table>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// --- ORIGINAL CSVS AND TAB LOGIC UNCHANGED ---
// All of your existing fetchCSV calls and renderTable calls go here exactly as before

// --- ENHANCEMENTS (SAFELY) ---
const eloEnhance = [];
const projectedEnhance = [];
const confEnhance = [];
const predictorEnhance = [];

// Helper to fetch CSV without touching existing arrays
function fetchEnhanceCSV(path, storeArray, callback){
  fetch(path).then(r=>r.ok?r.text():Promise.reject())
  .then(csv=>{
    const rows = csv.trim().split("\n").map(r=>r.split(","));
    storeArray.push(...rows.slice(1));
    if(callback) callback(rows.slice(1));
  }).catch(()=>console.warn(`Enhancement CSV not found: ${path}`));
}

// Load enhancement CSVs AFTER Elo table loads (safe)
fetchEnhanceCSV(`data/CBB_Elo_2026.csv`, eloEnhance, setupEnhancements);
fetchEnhanceCSV(`data/projected_bracket2026.csv`, projectedEnhance, setupEnhancements);
fetchEnhanceCSV(`data/CBB_Conference_Elo_2026.csv`, confEnhance, setupEnhancements);
fetchEnhanceCSV(`data/CBB_Elo_Future_Game_Predictions.csv`, predictorEnhance, setupEnhancements);

function setupEnhancements(){
  // Populate team selects once EloEnhance is loaded
  const t1 = document.getElementById("team1");
  const t2 = document.getElementById("team2");
  const tStats = document.getElementById("team-stats-select");
  t1.innerHTML = t2.innerHTML = tStats.innerHTML = "";
  eloEnhance.map(r=>r[0]).sort().forEach(team=>{
    [t1,t2,tStats].forEach(sel=>{
      const opt = document.createElement("option"); opt.value = team; opt.textContent = team;
      sel.appendChild(opt);
    });
  });

  // Matchup prediction
  document.getElementById("predict-btn").onclick = ()=>{
    const a = t1.value; const b = t2.value;
    const match = predictorEnhance.find(r=> (r[0]===a && r[1]===b) || (r[0]===b && r[1]===a));
    document.getElementById("predicted-winner").textContent = match ? `Predicted Winner: ${match[2]}` : "No prediction found";
  };

  // Team stats panel
  tStats.onchange = ()=>{
    const team = tStats.value;
    const out = document.getElementById("team-stats-output"); out.innerHTML = "";
    const elo = eloEnhance.find(r=>r[0]===team);
    const proj = projectedEnhance.find(r=>r[0]===team);
    const conf = confEnhance.find(r=>r[0]===team);
    if(elo) out.innerHTML += `<div><b>Elo:</b> ${elo[1]}</div>`;
    if(proj) out.innerHTML += `<div><b>Projected:</b> ${proj.slice(1).join(", ")}</div>`;
    if(conf) out.innerHTML += `<div><b>Conference Elo:</b> ${conf.slice(1).join(", ")}</div>`;
  };

  // Graphs
  const ctxElo = document.getElementById("elo-bar-chart").getContext("2d");
  new Chart(ctxElo, {type:'bar', data:{labels:eloEnhance.slice(0,10).map(r=>r[0]), datasets:[{label:'Elo',data:eloEnhance.slice(0,10).map(r=>Number(r[1])),backgroundColor:'#2196f3'}]}});
  
  const ctxPred = document.getElementById("predictor-scatter").getContext("2d");
  const scatterData = predictorEnhance.map(r=>({x:Number(r[3]),y:Number(r[4]),label:`${r[0]} vs ${r[1]}`}));
  new Chart(ctxPred,{type:'scatter', data:{datasets:[{label:'Higher vs Lower Elo', data:scatterData, backgroundColor:'purple'}]}, options:{plugins:{tooltip:{callbacks:{label: ctx=>ctx.raw.label + ` (High:${ctx.raw.x}, Low:${ctx.raw.y})`}}}, scales:{x:{title:{display:true,text:"Higher Seed Elo"}},y:{title:{display:true,text:"Lower Seed Elo"}}}}});
}
</script>
</body>
</html>
