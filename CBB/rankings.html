<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College Basketball Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PWG43QNM3P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PWG43QNM3P');
</script>

<style>
body {
  font-family: Arial, sans-serif;
  margin:0;
  padding:0;
  background:#f4f6f8;
  color:#111;
}
.page {
  max-width:1100px;
  margin:0 auto;
  padding:20px;
}
.top-nav {
  margin-bottom:20px;
}
.top-nav a {
  text-decoration:none;
  color:#111;
  font-weight:bold;
  font-size:0.9rem;
}
.top-nav a:hover {
  text-decoration:underline;
}
h1 {
  text-align:center;
  margin-bottom:10px;
}
.subtitle {
  text-align:center;
  margin-bottom:20px;
  color:#555;
}
.toggle-buttons {
  text-align:center;
  margin-bottom:20px;
}
.toggle-buttons button {
  padding:8px 16px;
  margin:0 5px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  background:#ddd;
  transition:0.2s;
}
.toggle-buttons button.active {
  background:#111;
  color:#fff;
}
.toggle-buttons button:hover {
  background:#aaa;
  color:#fff;
}
table {
  border-collapse:collapse;
  width:100%;
  margin-top:10px;
  background:#fff;
  border-radius:6px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
th, td {
  padding:8px 10px;
  border:1px solid #ccc;
  text-align:left;
}
th {
  background-color:#f2f2f2;
  cursor:pointer;
  user-select:none;
}
th.sort-asc::after {
  content:" ▲";
}
th.sort-desc::after {
  content:" ▼";
}
select {
  padding:6px 10px;
  margin-bottom:15px;
  border-radius:5px;
  border:1px solid #ccc;
}
</style>
</head>

<body>
<div class="page">
  <div class="top-nav">
    <a href="index.html">← Back to College Basketball</a>
  </div>

  <h1 id="title">College Basketball Rankings</h1>
  <div class="subtitle">Elo-based rankings by season (2003–2026)</div>

  <div class="toggle-buttons" id="toggle-buttons" style="display:none;">
    <button id="show-elo" class="active">Elo Rankings</button>
    <button id="show-projected" style="display:none;">Projected Seeding</button>
    <button id="show-conf-elo" style="display:none;">Conference Elo</button>
    <button id="show-conf-standings" style="display:none;">Conference Standings (2026)</button>
    <button id="show-game-predictor" style="display:none;">Game Predictor (2026)</button>
    <button id="show-resume" style="display:none;">Resume (2026)</button>
  </div>

  <!-- Elo Rankings -->
  <div id="elo-container">
    <table id="elo-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Projected Bracket -->
  <div id="projected-container" style="display:none;">
    <table id="projected-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Conference Elo -->
  <div id="conf-elo-container" style="display:none;">
    <table id="conf-elo-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Conference Standings Dropdown (2026 only) -->
  <div id="conf-standings-container" style="display:none;">
    <select id="conf-dropdown"></select>
    <table id="conf-standings-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Game Predictor (2026 only) -->
  <div id="game-predictor-container" style="display:none;">
    <table id="game-predictor-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Resume Tab (2026 only) -->
  <div id="resume-container" style="display:none;">
    <table id="resume-table">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const year = params.get("year") || "2026";

document.getElementById("title").textContent = `College Basketball ${year} Rankings`;

const eloCsv = `data/CBB_Elo_${year}.csv`;
const projectedCsv = `data/projected_bracket${year}.csv`;
const confEloCsv = `data/CBB_Conference_Elo_${year}.csv`;

const eloContainer = document.getElementById("elo-container");
const projectedContainer = document.getElementById("projected-container");
const confEloContainer = document.getElementById("conf-elo-container");
const confStandingsContainer = document.getElementById("conf-standings-container");
const gamePredictorContainer = document.getElementById("game-predictor-container");
const resumeContainer = document.getElementById("resume-container");

const toggleButtons = document.getElementById("toggle-buttons");
const showEloBtn = document.getElementById("show-elo");
const showProjectedBtn = document.getElementById("show-projected");
const showConfEloBtn = document.getElementById("show-conf-elo");
const showConfStandingsBtn = document.getElementById("show-conf-standings");
const showGamePredictorBtn = document.getElementById("show-game-predictor");
const showResumeBtn = document.getElementById("show-resume");

let eloData=[], projectedData=[], confEloData=[], confStandingsData={}, gamePredictorData=[], resumeData=[];
let sortState = {};

// --- Fetch Elo Rankings ---
fetch(eloCsv)
  .then(r=>{ if(!r.ok) throw new Error("Elo CSV not found"); return r.text(); })
  .then(csv=>{
    const rows = csv.trim().split("\n").map(r=>r.split(","));
    eloData = rows.slice(1);
    renderTable(rows[0], eloData, document.querySelector("#elo-table thead tr"), document.querySelector("#elo-table tbody"));
  })
  .catch(()=>{
    document.querySelector("#elo-table tbody").innerHTML = `<tr><td colspan="20">Elo data not found for ${year}.</td></tr>`;
  });

// --- Fetch Projected ---
fetch(projectedCsv)
  .then(r=>{ if(!r.ok) throw new Error("No projected CSV"); return r.text(); })
  .then(csv=>{
    const rows = csv.trim().split("\n").map(r=>r.split(","));
    projectedData = rows.slice(1);
    renderTable(rows[0], projectedData, document.querySelector("#projected-table thead tr"), document.querySelector("#projected-table tbody"));
    showProjectedBtn.style.display="inline-block";
    toggleButtons.style.display="block";
  })
  .catch(()=>console.warn("No projected bracket"));

// --- Fetch Conference Elo ---
fetch(confEloCsv)
  .then(r=>{ if(!r.ok) throw new Error("Conference Elo CSV not found"); return r.text(); })
  .then(csv=>{
    const rows = csv.trim().split("\n").map(r=>r.split(","));
    confEloData = rows.slice(1);
    renderTable(rows[0], confEloData, document.querySelector("#conf-elo-table thead tr"), document.querySelector("#conf-elo-table tbody"));
    showConfEloBtn.style.display="inline-block";
    toggleButtons.style.display="block";
  })
  .catch(()=>console.warn("Conference Elo CSV not found"));
</script>
</body>
</html>
